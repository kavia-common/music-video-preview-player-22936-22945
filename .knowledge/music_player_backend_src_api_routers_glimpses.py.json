{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for managing video glimpses attached to music tracks, including attaching, checking, streaming, and deleting glimpses. It uses FastAPI for web routing, handles file uploads, and interacts with in-memory track storage.", "external_files": ["../storage/memory", "./users"], "external_methods": ["get_current_user", "media_root_path"], "published": ["attach_glimpse", "has_glimpse", "stream_glimpse", "delete_glimpse"], "classes": [{"name": "GlimpseInfo", "description": "Pydantic model representing information about the glimpses attached to tracks."}], "methods": [{"name": "_ensure_video(file: UploadFile)", "description": "Validates that the uploaded file is a video based on its content type.", "scope": "", "scopeKind": ""}, {"name": "_ensure_track(track_id: str)", "description": "Checks if the track ID exists in the in-memory database.", "scope": "", "scopeKind": ""}, {"name": "attach_glimpse(track_id: str, video: UploadFile = File(...), user: UserPublic = Depends(get_current_user))", "description": "API endpoint to upload and attach a video glimpse to a track.", "scope": "", "scopeKind": ""}, {"name": "has_glimpse(track_id: str)", "description": "API endpoint to check if a track has an attached glimpse.", "scope": "", "scopeKind": ""}, {"name": "stream_glimpse(track_id: str)", "description": "API endpoint to stream the attached glimpse video.", "scope": "", "scopeKind": ""}, {"name": "delete_glimpse(track_id: str, user: UserPublic = Depends(get_current_user))", "description": "API endpoint to delete the attached glimpse from a track.", "scope": "", "scopeKind": ""}], "calls": ["os.makedirs", "await video.read", "os.path.exists", "open", "os.remove"], "search-terms": ["glimpses", "video glimpse", "attach_glimpse", "stream_glimpse", "delete_glimpse", "GlimpseInfo", "Media root path"], "state": 2, "file_id": 9, "knowledge_revision": 44, "git_revision": "9dccd2884370b9b78c66b02bda187cb9d7a42fe9", "revision_history": [{"20": ""}, {"44": "9dccd2884370b9b78c66b02bda187cb9d7a42fe9"}], "ctags": [{"_type": "tag", "name": "GlimpseInfo", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/glimpses.py", "pattern": "/^class GlimpseInfo(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_ensure_track", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/glimpses.py", "pattern": "/^def _ensure_track(track_id: str):$/", "language": "Python", "kind": "function", "signature": "(track_id: str)"}, {"_type": "tag", "name": "_ensure_video", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/glimpses.py", "pattern": "/^def _ensure_video(file: UploadFile):$/", "language": "Python", "kind": "function", "signature": "(file: UploadFile)"}, {"_type": "tag", "name": "attach_glimpse", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/glimpses.py", "pattern": "/^async def attach_glimpse(track_id: str, video: UploadFile = File(...), user: UserPublic = Depend/", "language": "Python", "kind": "function", "signature": "(track_id: str, video: UploadFile = File(...), user: UserPublic = Depends(get_current_user))"}, {"_type": "tag", "name": "delete_glimpse", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/glimpses.py", "pattern": "/^def delete_glimpse(track_id: str, user: UserPublic = Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(track_id: str, user: UserPublic = Depends(get_current_user))"}, {"_type": "tag", "name": "has_glimpse", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/glimpses.py", "pattern": "/^    has_glimpse: bool = Field(..., description=\"Whether a glimpse is attached\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "GlimpseInfo", "scopeKind": "class"}, {"_type": "tag", "name": "has_glimpse", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/glimpses.py", "pattern": "/^def has_glimpse(track_id: str):$/", "language": "Python", "kind": "function", "signature": "(track_id: str)"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/glimpses.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "stream_glimpse", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/glimpses.py", "pattern": "/^def stream_glimpse(track_id: str):$/", "language": "Python", "kind": "function", "signature": "(track_id: str)"}, {"_type": "tag", "name": "track_id", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/glimpses.py", "pattern": "/^    track_id: str = Field(..., description=\"Associated track ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "GlimpseInfo", "scopeKind": "class"}], "hash": "c140d5c29c07a8217f17399cbc643d7e", "format-version": 4, "code-base-name": "music_player_backend", "filename": "music_player_backend/src/api/routers/glimpses.py", "fields": [{"name": "bool has_glimpse", "scope": "GlimpseInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str track_id", "scope": "GlimpseInfo", "scopeKind": "class", "description": "unavailable"}]}