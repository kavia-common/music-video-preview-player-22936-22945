{"is_source_file": true, "format": "Python (FastAPI)", "description": "This file defines API routes for managing music tracks in a backend music player application. It includes endpoints for uploading, listing, retrieving, updating, deleting, and streaming music tracks. It also declares data models for track metadata responses and requests.", "external_files": ["../storage/memory", ".users"], "external_methods": ["get_current_user", "media_root_path"], "published": ["router", "create_track", "list_tracks", "get_track", "update_track", "delete_track", "stream_track"], "classes": [{"name": "TrackCreateResponse", "description": "Pydantic model representing a track data response with id, title, artist, duration, and glimpse info."}, {"name": "TrackUpdateRequest", "description": "Pydantic model for optional track metadata updates (title, artist, duration)."}, {"name": "TrackListItem", "description": "Inherits from TrackCreateResponse, used for listing tracks."}], "methods": [{"name": "_ensure_media_dir()", "description": "Ensures the media directory exists for storing audio files.", "scope": "", "scopeKind": ""}, {"name": "create_track( title: str = Form(...), artist: str = Form(...), duration_sec: Optional[int] = Form(None), audio: UploadFile = File(...), user: UserPublic = Depends(get_current_user), )", "description": "API endpoint to upload an audio file and create a new track entry in the database.", "scope": "", "scopeKind": ""}, {"name": "list_tracks()", "description": "API endpoint to list all tracks in the library.", "scope": "", "scopeKind": ""}, {"name": "get_track(track_id: str)", "description": "API endpoint to retrieve specific track metadata by ID.", "scope": "", "scopeKind": ""}, {"name": "update_track(track_id: str, body: TrackUpdateRequest, user: UserPublic = Depends(get_current_user))", "description": "API endpoint to update track metadata fields.", "scope": "", "scopeKind": ""}, {"name": "delete_track(track_id: str, user: UserPublic = Depends(get_current_user))", "description": "API endpoint to delete a track and remove its associated files.", "scope": "", "scopeKind": ""}, {"name": "stream_track(track_id: str)", "description": "API endpoint to stream audio bytes for a specific track.", "scope": "", "scopeKind": ""}], "calls": ["os.makedirs", "secrets.token_hex", "open", "os.remove", "os.path.exists", "os.path.exists"], "search-terms": ["FastAPI tracks management", "audio upload endpoint", "track streaming", "track metadata API", "Music API routes"], "state": 2, "file_id": 7, "knowledge_revision": 16, "git_revision": "", "ctags": [{"_type": "tag", "name": "TrackCreateResponse", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^class TrackCreateResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "TrackListItem", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^class TrackListItem(TrackCreateResponse):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "TrackUpdateRequest", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^class TrackUpdateRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_ensure_media_dir", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^def _ensure_media_dir():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "artist", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^    artist: Optional[str] = Field(None, description=\"Artist name\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "TrackUpdateRequest", "scopeKind": "class"}, {"_type": "tag", "name": "artist", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^    artist: str = Field(..., description=\"Artist name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TrackCreateResponse", "scopeKind": "class"}, {"_type": "tag", "name": "create_track", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^async def create_track($/", "language": "Python", "kind": "function", "signature": "( title: str = Form(...), artist: str = Form(...), duration_sec: Optional[int] = Form(None), audio: UploadFile = File(...), user: UserPublic = Depends(get_current_user), )"}, {"_type": "tag", "name": "delete_track", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^def delete_track(track_id: str, user: UserPublic = Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(track_id: str, user: UserPublic = Depends(get_current_user))"}, {"_type": "tag", "name": "duration_sec", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^    duration_sec: Optional[int] = Field(None, description=\"Duration in seconds\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "TrackCreateResponse", "scopeKind": "class"}, {"_type": "tag", "name": "duration_sec", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^    duration_sec: Optional[int] = Field(None, description=\"Duration in seconds\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "TrackUpdateRequest", "scopeKind": "class"}, {"_type": "tag", "name": "get_track", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^def get_track(track_id: str):$/", "language": "Python", "kind": "function", "signature": "(track_id: str)"}, {"_type": "tag", "name": "has_glimpse", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^    has_glimpse: bool = Field(False, description=\"Whether a video glimpse is attached\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "TrackCreateResponse", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^    id: str = Field(..., description=\"Track ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TrackCreateResponse", "scopeKind": "class"}, {"_type": "tag", "name": "list_tracks", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^def list_tracks():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "stream_track", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^def stream_track(track_id: str):$/", "language": "Python", "kind": "function", "signature": "(track_id: str)"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^    title: Optional[str] = Field(None, description=\"Track title\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "TrackUpdateRequest", "scopeKind": "class"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^    title: str = Field(..., description=\"Track title\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TrackCreateResponse", "scopeKind": "class"}, {"_type": "tag", "name": "update_track", "path": "/home/kavia/workspace/code-generation/music-video-preview-player-22936-22945/music_player_backend/src/api/routers/tracks.py", "pattern": "/^def update_track(track_id: str, body: TrackUpdateRequest, user: UserPublic = Depends(get_current/", "language": "Python", "kind": "function", "signature": "(track_id: str, body: TrackUpdateRequest, user: UserPublic = Depends(get_current_user))"}], "hash": "6c937def911adb7d8cbab6742e638b3f", "format-version": 4, "code-base-name": "music_player_backend", "filename": "music_player_backend/src/api/routers/tracks.py", "fields": [{"name": "Optional[str] artist", "scope": "TrackUpdateRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str artist", "scope": "TrackCreateResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] duration_sec", "scope": "TrackCreateResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "bool has_glimpse", "scope": "TrackCreateResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str id", "scope": "TrackCreateResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] title", "scope": "TrackUpdateRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str title", "scope": "TrackCreateResponse", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"16": ""}]}